import React, { Component } from 'react';
import lottie from 'lottie-web';

export default class Sandbox2 extends Component {
  constructor(props) {
    super(props);
    this.canvasRef = React.createRef();
    this.state = {
      isStopped: !this.props.autoPlay,
      isPaused: !this.props.autoPlay,
      isComplete: false,
      isThrowing: false,
    }
  }
  
  componentWillUnmount() {
    this.deRegisterEvents([
      {
        eventName: 'DOMLoaded',
        callback: () => this.startAnimation(),
      },
      {
        eventName: 'complete',
        callback: () => this.endAnimation(),
      }
    ]);
    this.destroy();
    this.anim = null;
  }

  componentDidMount() {
    let params = {
      container: this.canvasRef.current,
      renderer: 'svg',
      rendererSettings: {
        preserveAspectRatio: 'xMidYMid slice',
        scaleMode: 'noScale',
      },
      loop: false,
      speed: 0.25,
      autoplay: true,
      animationData: {"v":"5.1.16","fr":29.9700012207031,"ip":0,"op":103.000004195276,"w":1920,"h":1080,"nm":"Comp 2","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":2,"ty":4,"nm":"R3","sr":1,"ks":{"o":{"a":0,"k":36,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":10,"s":[360],"e":[0]},{"t":41.0000016699642}],"ix":10},"p":{"a":0,"k":[962,424,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[64,64,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":14,"s":[{"i":[[-50.47,0],[-23.414,-11.624],[-16.425,-22.084],[0,-39.099],[29.169,-31.263],[50.519,0],[30.964,27.723],[0,51.818],[-29.224,31.274]],"o":[[27.914,0],[24.86,12.342],[21.669,29.134],[0,46.131],[-31.944,34.238],[-44.832,0],[-35.789,-32.043],[0,-46.18],[31.939,-34.179]],"v":[[0,-175],[77.715,-156.841],[140.509,-104.337],[175,0],[127.982,119.356],[0,175],[-116.689,130.419],[-175,0],[-127.888,-119.456]],"c":true}],"e":[{"i":[[-53.621,39.023],[-10.46,-17.61],[-7.348,-28.206],[3.369,-44.415],[16.01,-20.04],[28.636,-14.096],[31.843,-8.322],[33.076,53.604],[-34.978,69.742]],"o":[[53.621,-39.023],[22.727,38.372],[9.772,37.044],[-2.45,45.867],[-16.01,20.04],[-28.636,14.096],[-54.824,14.329],[-50.451,-90.988],[42.718,-85.174]],"v":[[15.867,-288.064],[115.548,-265.789],[161.634,-145.835],[175.009,22.123],[138.141,121.043],[64.433,184.543],[-42.371,224.509],[-195.216,201.889],[-131.158,-90.302]],"c":true}]},{"t":31.0000012626559}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"gf","o":{"a":0,"k":100,"ix":10},"r":1,"g":{"p":9,"k":{"a":0,"k":[0,0.929,0.341,0.58,0.125,0.929,0.341,0.58,0.25,0.929,0.341,0.58,0.375,0.959,0.39,0.416,0.5,0.988,0.439,0.251,0.625,0.988,0.439,0.251,0.75,0.988,0.439,0.251,0.875,0.994,0.52,0.184,1,1,0.6,0.118],"ix":9}},"s":{"a":0,"k":[-226.013,0],"ix":5},"e":{"a":0,"k":[172.998,204.956],"ix":6},"t":1,"nm":"Gradient Fill 1","mn":"ADBE Vector Graphic - G-Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[-48.438,-7.813],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[111.304,111.304],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":41.0000016699642,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"R1","sr":1,"ks":{"o":{"a":0,"k":36,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":41,"s":[720],"e":[123]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":53,"s":[123],"e":[0]},{"t":81.0000032991976}],"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":41,"s":[962,424,0],"e":[990,408,0],"to":[4.66666650772095,-2.66666674613953,0],"ti":[0.33333334326744,-19.3333339691162,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":48,"s":[990,408,0],"e":[960,540,0],"to":[-0.33333334326744,19.3333339691162,0],"ti":[5,-22,0]},{"t":76.0000030955435}],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":48,"s":[64,64,100],"e":[100,100,100]},{"t":76.0000030955435}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":48,"s":[{"i":[[72,-29],[44.387,-95.424],[14.44,-61.885],[-73.154,-12.134],[-72.938,30.857],[-23.368,29.21],[7.704,135.3]],"o":[[-55.5,24.5],[-29.32,63.033],[-10.5,45],[22.675,3.761],[81.857,-34.631],[42,-52.5],[-8.568,-150.482]],"v":[[-4,-345.5],[-183.887,-133.576],[-279,87],[-219.346,251.134],[-54.562,229.143],[87.5,147.5],[144.068,-74.518]],"c":true}],"e":[{"i":[[72,-29],[17.373,-33.114],[-33.5,-54],[-22.004,-12.428],[-26.905,-11.516],[-41.702,29.192],[57.055,128.263]],"o":[[-34.7,18.493],[-76.113,145.076],[11.039,17.794],[21.239,11.996],[84.376,36.115],[66.688,-46.682],[-88.068,-197.982]],"v":[[-7,-346.5],[-70.887,-259.576],[-83,119],[-32.346,174.134],[41.08,210.146],[267.5,243.5],[271.068,-17.518]],"c":true}]},{"t":76.0000030955435}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"gf","o":{"a":0,"k":100,"ix":10},"r":1,"g":{"p":9,"k":{"a":0,"k":[0,0.929,0.341,0.58,0.125,0.929,0.341,0.58,0.25,0.929,0.341,0.58,0.375,0.959,0.39,0.416,0.5,0.988,0.439,0.251,0.625,0.988,0.439,0.251,0.75,0.988,0.439,0.251,0.875,0.994,0.52,0.184,1,1,0.6,0.118],"ix":9}},"s":{"a":0,"k":[-92,242],"ix":5},"e":{"a":0,"k":[294,26],"ix":6},"t":1,"nm":"Gradient Fill 1","mn":"ADBE Vector Graphic - G-Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[-0.5,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":41.0000016699642,"op":191.000007779589,"st":41.0000016699642,"bm":0},{"ddd":0,"ind":4,"ty":4,"nm":"L3","sr":1,"ks":{"o":{"a":0,"k":36,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":41,"s":[720],"e":[123]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":57,"s":[123],"e":[0]},{"t":81.0000032991976}],"ix":10},"p":{"a":0,"k":[979,420,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":41,"s":[-64,64,100],"e":[-64,64,100]},{"t":81.0000032991976}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[72,-29],[17.373,-33.114],[-33.5,-54],[-22.004,-12.428],[-55,38.5],[57.055,128.263]],"o":[[-34.7,18.493],[-76.113,145.076],[11.039,17.794],[87.846,49.616],[66.688,-46.682],[-88.068,-197.982]],"v":[[-7,-346.5],[-70.887,-259.576],[-83,119],[-32.346,174.134],[267.5,243.5],[271.068,-17.518]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"gf","o":{"a":0,"k":100,"ix":10},"r":1,"g":{"p":9,"k":{"a":0,"k":[0,1,0.82,0.208,0.125,1,0.71,0.163,0.25,1,0.6,0.118,0.375,0.994,0.52,0.184,0.5,0.988,0.439,0.251,0.625,0.994,0.402,0.4,0.75,1,0.365,0.549,0.875,0.965,0.353,0.565,1,0.929,0.341,0.58],"ix":9}},"s":{"a":0,"k":[288.688,32.813],"ix":5},"e":{"a":0,"k":[-83.313,225],"ix":6},"t":1,"nm":"Gradient Fill 1","mn":"ADBE Vector Graphic - G-Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":41.0000016699642,"op":191.000007779589,"st":41.0000016699642,"bm":0},{"ddd":0,"ind":5,"ty":4,"nm":"L2","sr":1,"ks":{"o":{"a":0,"k":36,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":41,"s":[720],"e":[123]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":60,"s":[123],"e":[0]},{"t":81.0000032991976}],"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":48,"s":[979,420,0],"e":[982,474,0],"to":[0.5,9,0],"ti":[-0.5,-9,0]},{"t":73.000002973351}],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":51,"s":[-64,64,100],"e":[-80,80,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":71,"s":[-80,80,100],"e":[-80,80,100]},{"t":81.0000032991976}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[72,-29],[17.373,-33.114],[-33.5,-54],[-22.004,-12.428],[-55,38.5],[57.055,128.263]],"o":[[-34.7,18.493],[-76.113,145.076],[11.039,17.794],[87.846,49.616],[66.688,-46.682],[-88.068,-197.982]],"v":[[-7,-346.5],[-70.887,-259.576],[-83,119],[-32.346,174.134],[267.5,243.5],[271.068,-17.518]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"gf","o":{"a":0,"k":100,"ix":10},"r":1,"g":{"p":9,"k":{"a":0,"k":[0,1,0.82,0.208,0.125,1,0.71,0.163,0.25,1,0.6,0.118,0.375,0.994,0.52,0.184,0.5,0.988,0.439,0.251,0.625,0.994,0.402,0.4,0.75,1,0.365,0.549,0.875,0.965,0.353,0.565,1,0.929,0.341,0.58],"ix":9}},"s":{"a":0,"k":[294,35],"ix":5},"e":{"a":0,"k":[-75.5,202.5],"ix":6},"t":1,"nm":"Gradient Fill 1","mn":"ADBE Vector Graphic - G-Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":41.0000016699642,"op":191.000007779589,"st":41.0000016699642,"bm":0},{"ddd":0,"ind":6,"ty":4,"nm":"L1","sr":1,"ks":{"o":{"a":0,"k":36,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":41,"s":[720],"e":[123]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":65,"s":[123],"e":[0]},{"t":81.0000032991976}],"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":48,"s":[979,420,0],"e":[987,540,0],"to":[1.33333337306976,20,0],"ti":[-1.33333337306976,-20,0]},{"t":67.0000027289659}],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":51,"s":[-64,64,100],"e":[-100,100,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"n":["0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167","0p833_0p833_0p167_0p167"],"t":71,"s":[-100,100,100],"e":[-100,100,100]},{"t":81.0000032991976}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[72,-29],[17.373,-33.114],[-33.5,-54],[-22.004,-12.428],[-55,38.5],[57.055,128.263]],"o":[[-34.7,18.493],[-76.113,145.076],[11.039,17.794],[87.846,49.616],[66.688,-46.682],[-88.068,-197.982]],"v":[[-7,-346.5],[-70.887,-259.576],[-83,119],[-32.346,174.134],[267.5,243.5],[271.068,-17.518]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"gf","o":{"a":0,"k":100,"ix":10},"r":1,"g":{"p":9,"k":{"a":0,"k":[0,1,0.82,0.208,0.125,1,0.71,0.163,0.25,1,0.6,0.118,0.375,0.994,0.52,0.184,0.5,0.988,0.439,0.251,0.613,0.994,0.402,0.4,0.726,1,0.365,0.549,0.863,0.965,0.353,0.565,1,0.929,0.341,0.58],"ix":9}},"s":{"a":0,"k":[298,21],"ix":5},"e":{"a":0,"k":[-99,225],"ix":6},"t":1,"nm":"Gradient Fill 1","mn":"ADBE Vector Graphic - G-Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":41.0000016699642,"op":191.000007779589,"st":41.0000016699642,"bm":0}],"markers":[]}
    };

    this.anim = lottie.loadAnimation(params);

    this.registerEvents([
      {
        eventName: 'DOMLoaded',
        callback: () => this.startAnimation(),
      },
      {
        eventName: 'complete',
        callback: () => this.endAnimation(),
      }
    ]);
  }

  handleClick = () => {
    if(this.state.isThrowing){
      return;
    }

    this.state.isThrowing = true;

    this.anim.setSpeed(0.5);
    this.anim.playSegments([[27,142],[14,26]],true);
    
    let baconRand = Math.random()*1420;
    let butterXpos;

    if(baconRand < 1420/2){
      butterXpos = 500 + 900 + Math.random()*900;
    } else {
      butterXpos = 500 + Math.random()*900;
    }

    let baconPos = [-100+baconRand,480+Math.random()*370,0];
    let butterPos = [butterXpos,470+Math.random()*430,0];

    this.anim.animationData.layers[0].ks.p.k[0].e = baconPos;
    this.anim.animationData.layers[2].ks.p.k[0].e = baconPos;
    this.anim.animationData.layers[1].ks.p.k[0].e = butterPos;
    this.anim.animationData.layers[3].ks.p.k[0].e = butterPos;

    this.anim.addEventListener('complete', this.throwComplete);
  }

  startAnimation = () => {
    console.log('start!');
    this.anim.play();
  }

  endAnimation = () => {
    console.log('end!');
    this.canvasRef.current.classList.remove('animating');
  }

  registerEvents(eventListeners) {
    eventListeners.forEach((eventListener) => {
      this.anim.addEventListener(eventListener.eventName, eventListener.callback);
    });
  }

  deRegisterEvents(eventListeners) {
    eventListeners.forEach((eventListener) => {
      this.anim.removeEventListener(eventListener.eventName, eventListener.callback);
    });
  }

  destroy() {
    this.anim.destroy();
  }

  render() {
    const {
      width,
      height,
    } = this.props;

    const getSize = (initial) => {
      let size;

      if (typeof initial === 'number') {
        size = `${initial}px`;
      } else {
        size = initial || '100%';
      }

      return size;
    };

    const lottieStyles = {
      width: getSize(width),
      height: getSize(height),
      overflow: 'hidden',
      margin: '0 auto',
      outline: 'none',
      ...this.props.style,
    };

    return (
      <div
        className='logo animating'
        ref={this.canvasRef}
        style={lottieStyles}
        tabIndex="0"
      />
    );
  }
}

